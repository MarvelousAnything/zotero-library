(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{m3lf:function(e,t,n){"use strict";n.r(t);var r,o=n("gcR/"),i=n.n(o),s=n("lSNA"),a=n.n(s),c=n("yXPU"),u=n.n(c),f=n("J4zp"),l=n.n(f),d=n("o0o1"),p=n.n(d),h=n("q1tI"),v=n.n(h),b=(n("17x9"),n("jOYC")),w=n("5pww"),m=n("tnOI"),g=n.n(m),y=n("Jqp9"),k=n("rDLW"),P=n("Gl8y"),S=n("JwCr"),O=n.n(S),x=n("wXC7"),E=n.n(x),j=Object(y.css)("position:absolute;width:104%;right:-2%;max-width:375px;background-color:#2671dc;box-shadow:0 2px 4px rgba(0,0,0,0.25);border-radius:4px;font-family:",E.a.font.franklinBase,";font-size:",E.a.font.size(14),";line-height:",E.a.font.size(16),";color:",E.a.color.white,";box-sizing:border-box;bottom:78px;z-index:199;text-align:left;padding:12px;&::after{position:absolute;width:16px;height:16px;right:6%;bottom:-8px;background:#2671dc;border-radius:1px;transform:rotate(-135deg);content:' ';}"),N=Object(y.css)("font-size:",E.a.font.size(14),";line-height:",E.a.font.size(16),";font-family:",E.a.font.franklinBase,";.ANDROID &{max-width:340px;}"),A=Object(y.css)("&::after{top:-8px;transform:rotate(135deg);}"),I=function(e){var t=e.arrowPosition,n=e.handleCloseTooltip,o=Object(h.useState)(!1),s=l()(o,2),c=s[0],u=s[1];return Object(h.useEffect)((function(){var e;null!==(e=document)&&void 0!==e&&e.querySelector(".ANDROID")&&u(!0)}),[]),i()("button",{type:"button",className:Object(y.cx)(j,a()({},A,"top"===t)),onClick:n},void 0,i()("p",{className:N},void 0,"Turn on notifications to ",r||(r=i()(O.a,{},void 0,"receive alerts as stories develop"))," in real-time."," ",c?"":"You can manage alerts in your appâ€™s settings."))};I.displayName="Tooltip",I.defaultProps={arrowPosition:"bottom"};var _=I,T=Object(y.css)("position:absolute;top:50%;left:50%;width:50px;height:30px;border-radius:20px;transform:translateX(-50%) translateY(-50%);cursor:pointer;overflow:hidden;&:focus{outline:none;}&:hover{box-shadow:0 0 2px var(--clr-shadow,rgba(0,0,0,0.3));}&::after{content:'';position:absolute;top:2px;width:26px;height:26px;border-radius:20px;transition:left 250ms ease-in-out;background-color:",E.a.color.white,";}&.on{background-color:#2671dc;&::after{left:calc(50% - 3px);}}&.off{background-color:",E.a.color.gray60,";&::after{left:3px;box-shadow:1px 1px 3px 0 rgba(0,0,0,0.1);}}"),C=Object(y.css)("position:relative;width:50px;height:30px;"),U=Object(y.css)("display:flex;justify-content:space-between;padding-top:22px;align-items:center;"),R=Object(y.css)("font-weight:",E.a.font.weight.medium,";font-size:",E.a.font.size(16),";font-family:",E.a.font.franklinBase,";"),W=Object(y.css)("font-weight:",E.a.font.weight.medium,";font-size:",E.a.font.size(12),";font-family:",E.a.font.franklinBase,";color:#a61717;"),D=Object(y.css)("height:100%;position:relative;border-top:1px solid ",E.a.color.gray60,";border-bottom:1px solid ",E.a.color.gray60,";"),L=Object(y.css)("border-top:none;"),F=Object(y.css)("border-bottom:none;");function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=function(e){return{subscribed:{title:e?"Live Update: ".concat(e):"Live Update",body:e?"You will receive alerts as this story develops.":"You will receive alerts for a live story."},unsubscribed:{title:"Unsubscribed",body:e?"You will no longer receive live update alerts for ".concat(e,"."):"You will no longer receive live update alerts."}}},q=function(e){var t,n=e.topic,r=e.kicker,o=e.onView,s=e.isControl,c=e.onSubscribe,f=e.onUnsubscribe,d=e.tooltipArrowPosition,m=Object(y.useTheme)().shouldRender,S=Object(h.useState)(!1),O=l()(S,2),x=O[0],E=O[1],j=Object(h.useState)(!1),N=l()(j,2),A=N[0],I=N[1],z=Object(h.useState)(!1),q=l()(z,2),M=q[0],V=q[1],H=Object(h.useState)(!0),B=l()(H,2),G=B[0],K=B[1],X=Object(h.useState)(),Z=l()(X,2),Q=Z[0],$=Z[1],ee="styln_live_signup_alert_tooltip",te=Object(P.a)({}),ne=l()(te,2),re=ne[0],oe=ne[1];Object(h.useEffect)((function(){o&&null!=oe&&oe.isIntersecting&&o({isSubscribed:x})}),[o,null==oe?void 0:oe.isIntersecting,x]);var ie=function(){var e=u()(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.ready;case 2:return Object(k.setConfiguration)({host:"prd"!==vi.env.ENVIRONMENT?"https://pushkin.stg.newsdev.nytimes.com":"https://pushkin.newsdev.nytimes.com",key:"prd"!==vi.env.ENVIRONMENT?"ei+cXKvl4+GxAfZJ6VUzZeS+lQZ4myKLGHIjU+EqXf8=":"8M6V4P/FFjTCOroeyAR3+kFBAhjGzMXasr1Q6gzrHVE=",ios:{bundleName:"com.nytimes.NYTimes",sandbox:"prd"!==vi.env.ENVIRONMENT}}),e.prev=3,e.next=6,Object(k.getSubscribedTopics)();case 6:return t=e.sent,e.abrupt("return",t);case 10:return e.prev=10,e.t0=e.catch(3),K(!1),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(){return e.apply(this,arguments)}}();Object(h.useEffect)((function(){G&&ie().then((function(e){e&&Array.isArray(e)&&(K(!1),e.includes(n)&&E(!0))}))}));var se=function(e){if(null==e||e.stopPropagation(),I(!1),!w.a)return null;var t=w.a.getItem(ee),n={};return t&&(n=Y(Y({},n=JSON.parse(t)),{},{dismissed:!0})),w.a.setItem(ee,JSON.stringify(n))},ae=function(){var e=u()(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(!0),A&&se(),e.prev=2,e.next=5,Object(k.subscribeToTopic)(n,{notification:null===(t=J(r))||void 0===t?void 0:t.subscribed});case 5:c&&c(),Q&&$(),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),E(!1),$("Something went wrong. Please try again in a moment.");case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(){return e.apply(this,arguments)}}(),ce=function(){var e=u()(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return E(!1),e.prev=1,e.next=4,Object(k.unsubscribeFromTopic)(n,{notification:null===(t=J(r))||void 0===t?void 0:t.unsubscribed});case 4:f&&f(),Q&&$(),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),E(!0),$("Something went wrong. Please try again in a moment.");case 12:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}();return Object(h.useEffect)((function(){var e,t,n;M||(t={},((n=w.a.getItem(ee))?(t=JSON.parse(n)).seen<3&&(e=t.lastSeen,g()().diff(e,"h")>=24)&&!t.dismissed&&(t={seen:t.seen+1,lastSeen:g()(),dismissed:t.dismissed},w.a.setItem(ee,JSON.stringify(t)),1):(t={seen:1,dismissed:!1,lastSeen:g()()},w.a.setItem(ee,JSON.stringify(t)),1))&&I(!0),V(!0))}),[M]),k.supportsNotifications?G||s?v.a.createElement("div",{ref:re}):v.a.createElement("div",{ref:re,className:Object(y.cx)(b.b.layout.news,D,(t={},a()(t,L,null==m?void 0:m.bulletBlock),a()(t,F,null==m?void 0:m.postDivider),t))},A&&i()(_,{handleCloseTooltip:se,arrowPosition:d}),i()("div",{className:U},void 0,i()("p",{className:R},void 0,"Get alerts for live updates."),i()("div",{className:C},void 0,i()("button",{type:"button","aria-label":"Subscribe to alerts toggle button",className:Object(y.cx)(T,x?"on":"off"),onClick:x?ce:ae}))),i()("div",{},void 0,Q&&i()("p",{className:W},void 0,Q))):null};q.defaultProps={kicker:"",tooltipArrowPosition:"bottom",onView:void 0,onSubscribe:void 0,onUnsubscribe:void 0,isControl:!1};t.default=q},rDLW:function(e,t,n){!function(e){"use strict";var t=void 0,n={get host(){if(!t)throw new Error("You must provide the Pushkin configuration via setConfiguration()");return t.host},get key(){if(!t)throw new Error("You must provide the Pushkin configuration via setConfiguration()");return t.key},ios:{get bundleName(){if(!t||!t.ios)throw new Error("You must provide the Pushkin configuration via setConfiguration()");return t.ios.bundleName},get sandbox(){if(!t||!t.ios)throw new Error("You must provide the Pushkin configuration via setConfiguration()");return t.ios.sandbox}},get subscribeCloudFunctionURL(){if(!t)throw new Error("You must provide the Pushkin configuration via setConfiguration()");return t.subscribeCloudFunctionURL},get serviceWorkerScope(){if(!t)throw new Error("You must provide the Pushkin configuration via setConfiguration()");return t.serviceWorkerScope?new URL(t.serviceWorkerScope,self.location.href).href:null}},r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function o(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function i(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function a(e,t,r){return void 0===t&&(t="GET"),i(this,void 0,void 0,(function(){var o,i;return s(this,(function(s){switch(s.label){case 0:return[4,fetch(n.host+e,{method:t,headers:{Authorization:n.key,"Content-Type":"application/json"},body:r?JSON.stringify(r):void 0})];case 1:return[4,(o=s.sent()).json()];case 2:if(i=s.sent(),!1===o.ok)throw new Error(i.error);return[2,i]}}))}))}var c=new(function(e){function t(){var t=e.call(this)||this;return t._state="default",t.request=function(){throw new Error("No platform implementation provided a permission prompt")},t}return o(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){if(e!==this._state){this._state=e;var t=new Event("change",{target:this});this.fireEvent(t)}},enumerable:!0,configurable:!0}),t}(function(){function e(){this.events={}}return e.prototype.addEventListener=function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)},e.prototype.removeEventListener=function(e,t){if(this.events[e]){var n=this.events[e].indexOf(t);-1!==n&&this.events[e].splice(n,1)}},e.prototype.fireEvent=function(e){this.events[e.type]&&this.events[e.type].forEach((function(t){return t(e)}))},e}())),u="pushkin__ios_device_token",f=!1;function l(){return i(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){switch(n.label){case 0:if(e=window.localStorage.getItem(u),!1===f&&null===e)throw c.state="denied",new Error("Page has been reloaded so we've lost the device data event. You need to recreate the webview.");return[4,new Promise((function(t,n){if(!1===f)return console.info("PUSH: token fetch event won't work, so using cached token"),void t(e);if("complete"===document.readyState||"interactive"===document.readyState){var r=window.config&&window.config.userInfo&&window.config.userInfo.pushToken;return t(r||null)}var o=setTimeout((function(){n(new Error("The document did not become ready within the threshold"))}),1e3);document.addEventListener("DOMContentLoaded",(function(){clearTimeout(o);var e=window.config&&window.config.userInfo&&window.config.userInfo.pushToken;return t(e||null)}))}))];case 1:return(t=n.sent())?(console.info("PUSH: Received a push token"),window.localStorage.setItem(u,t),c.state="granted"):(console.info("PUSH: Received device info with no token attached"),window.localStorage.removeItem(u),c.state="default"),[2,t]}}))}))}function d(e){return i(this,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return e?[4,h()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2,l()]}}))}))}function p(){return"pushkin__ios_"+encodeURIComponent(n.host)+"_"+n.ios.bundleName+"_"+n.ios.sandbox+"_id"}function h(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return"granted"===c.state?[2,c.state]:((e=document.createElement("a")).setAttribute("href","nytimes://notifications"),e.style.display="none",document.body.appendChild(e),e.click(),[4,new Promise((function(e){var t=function(){"hidden"!==document.visibilityState&&(window.removeEventListener("visibilitychange",t,!0),e())};window.addEventListener("visibilitychange",t,!0)}))]);case 1:return t.sent(),document.body.removeChild(e),console.info("PUSH: Page visible again, so checking for token..."),[4,l()];case 2:return t.sent(),[2,c.state]}}))}))}var v,b=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(Error),w=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(Error),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t}(Error);function g(){return i(this,void 0,void 0,(function(){var e,t,n,r,o=this;return s(this,(function(a){switch(a.label){case 0:return e=!1,[4,function(e,t,n){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,new Promise((function(e,t){var r=indexedDB.open("pushkin-client-nyt",1);r.onupgradeneeded=function(e){return n(e,r.result)},r.onerror=function(){return t(r.error)},r.onsuccess=function(){return e(r.result)}}))]}))}))}(0,0,(function(t,n){0===t.oldVersion&&(e=!0,n.createObjectStore("firebase-tokens",{keyPath:"id",autoIncrement:!0}).createIndex("endpoint","endpoint"))}))];case 1:if(t=a.sent(),!1===e||"localStorage"in self==0)return[2,t];n=function(e){var n,r,a,c;return s(this,(function(u){switch(u.label){case 0:return(n=localStorage.key(e))?(r=/pushkin__web_(.*)_(.*)_id/.exec(n),console.log(n,r),r?(a=decodeURIComponent(r[1]),c=decodeURIComponent(r[2]),[4,k(t,["firebase-tokens"],"readwrite",(function(e){return i(o,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,y(e.objectStore("firebase-tokens").add({platform:"web",endpoint:c,pushkinHost:a,token:localStorage.getItem(n)}))];case 1:return t.sent(),[2]}}))}))}))]):[3,2]):[2,"continue"];case 1:u.sent(),window.localStorage.removeItem(n),u.label=2;case 2:return[2]}}))},r=0,a.label=2;case 2:return r<localStorage.length?[5,n(r)]:[3,5];case 3:a.sent(),a.label=4;case 4:return r++,[3,2];case 5:return[2,t]}}))}))}function y(e){return new Promise((function(t,n){e.onerror=function(){return n(e.error)},e.onsuccess=function(){return t(e.result)}}))}function k(e,t,n,r){return i(this,void 0,void 0,(function(){var o,a,c=this;return s(this,(function(u){switch(u.label){case 0:return o=e.transaction(t,n),[4,r(o)];case 1:return a=u.sent(),[2,new Promise((function(e,t){return i(c,void 0,void 0,(function(){return s(this,(function(n){return o.oncomplete=function(){return e(a)},o.onerror=function(){return t(o.error)},[2]}))}))}))]}}))}))}function P(e,t){return i(this,void 0,void 0,(function(){var r,o,c,u,f,l=this;return s(this,(function(d){switch(d.label){case 0:return[4,function(e){return i(this,void 0,void 0,(function(){var t,r,o,i,a,c,u,f,l,d;return s(this,(function(s){switch(s.label){case 0:if(!(r="registration"in self&&self.registration instanceof ServiceWorkerRegistration))return[3,1];if(t=self.registration,n.serviceWorkerScope&&n.serviceWorkerScope!==t.scope)throw new Error("Pushkin has been registered for a different scope than this worker lives in");return[3,5];case 1:return n.serviceWorkerScope?[4,navigator.serviceWorker.getRegistrations()]:[3,3];case 2:if(o=s.sent(),!(i=o.find((function(e){return e.scope===n.serviceWorkerScope}))))throw new Error("There is no service worker at the scope specified in the config");return t=i,[3,5];case 3:return[4,navigator.serviceWorker.getRegistration()];case 4:if(!(a=s.sent()))throw new Error("There is no service worker registered - you need to have one in order to use notifications.");t=a,s.label=5;case 5:return[4,t.pushManager.getSubscription()];case 6:if(c=s.sent())return[2,c];if(0==(u="granted"===Notification.permission)&&r)throw new m("Permission for notifications not granted, and can't ask inside a worker");return!1===u&&!1===e?[2,void 0]:!1!==u?[3,8]:[4,Notification.requestPermission()];case 7:if("granted"!==s.sent())throw new b;s.label=8;case 8:return[4,fetch(n.host+"/vapid-key",{headers:{authorization:n.key}})];case 9:if(!(f=s.sent()).ok)throw new Error("Could not get VAPID key");return d=Uint8Array.bind,[4,f.arrayBuffer()];case 10:return l=new(d.apply(Uint8Array,[void 0,s.sent()])),[4,t.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:l})];case 11:return[2,s.sent()]}}))}))}(e)];case 1:if(!(r=d.sent()))throw new Error("No push payload available");return o=r.endpoint,[4,g()];case 2:return[4,k(c=d.sent(),["firebase-tokens"],"readonly",(function(e){return y(e.objectStore("firebase-tokens").index("endpoint").get(o))}))];case 3:if(u=d.sent())return c.close(),[2,u.token];if(!1===t)throw new Error("No locally cached token available");return[4,a("/registrations","POST",{subscription:r.toJSON()})];case 4:return f=d.sent().id,[4,k(c,["firebase-tokens"],"readwrite",(function(e){return i(l,void 0,void 0,(function(){return s(this,(function(t){switch(t.label){case 0:return[4,y(e.objectStore("firebase-tokens").add({pushkinHost:n.host,endpoint:o,token:f,platform:"web"}))];case 1:return t.sent(),[2]}}))}))}))];case 5:return d.sent(),c.close(),[2,f]}}))}))}function S(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Notification.requestPermission()]}))}))}function O(t,n){return"undefined"!=typeof document&&document.documentElement.classList.contains("Hybrid")&&document.documentElement.classList.contains("ANDROID")||t.indexOf("nyt_android/")>-1?e.Platform.AndroidApp:t.indexOf("nytios/")>-1?e.Platform.iOSApp:"PushManager"in n&&"Notification"in n?e.Platform.WebSupportsPush:e.Platform.WebNoPushSupport}(v=e.Platform||(e.Platform={})).iOSApp="iOSApp",v.AndroidApp="AndroidApp",v.WebSupportsPush="WebSupportsPush",v.WebNoPushSupport="WebNoPushSupport",v.Unknown="Unknown",e.devicePlatform=e.Platform.Unknown,"undefined"!=typeof self&&"navigator"in self&&(e.devicePlatform=O(navigator.userAgent,self));var x=void 0;function E(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return[4,function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return x?(console.log("return existing promise"),[2,x]):[2,x=new Promise((function(e,t){if(Array.from(document.head.getElementsByTagName("script")).find((function(e){return"https://int.nyt.com/android-device-data.js"===e.src})))return console.log("return existing element"),x=void 0,e();console.log("create new script");var n=document.createElement("script");n.setAttribute("src","https://int.nyt.com/android-device-data.js"),document.head.appendChild(n),n.onload=function(){e(),x=void 0},n.onerror=function(e){t(e),x=void 0}}))]}))}))}()];case 1:return t.sent(),(e=localStorage.getItem("OVERRIDE_FCM_TOKEN_KEY"))?[2,e]:[2,new Promise((function(e,t){var n=new Event("nyt:interactive:get-device-data");n.callback=function(n){n.userInfo.pushToken||t(new b),e(n.userInfo.pushToken)},window.dispatchEvent(n)}))]}}))}))}function j(t,r){return i(this,void 0,void 0,(function(){return s(this,(function(o){if(e.devicePlatform===e.Platform.iOSApp)return[2,function(e,t){return i(this,void 0,void 0,(function(){var r,o,i;return s(this,(function(s){switch(s.label){case 0:try{if(r=window.localStorage.getItem(p()))return[2,r]}catch(e){console.warn("Failed when checking for cached Firebase ID",e)}if(!1===t)throw new Error("No locally cached token available");return[4,d(e)];case 1:if(!(o=s.sent()))throw new Error("Device has no push token. Run this function with requestPermissionIfRequired to show permission modal.");return[4,a("/registrations","POST",{subscription:{sandbox:n.ios.sandbox,device_id:o,bundle_name:n.ios.bundleName,platform:"iOS"}})];case 2:i=s.sent();try{window.localStorage.setItem(p(),i.id)}catch(e){console.warn("Could not cache Firebase ID",e)}return[2,i.id]}}))}))}(t,r)];if(e.devicePlatform===e.Platform.AndroidApp)return[2,E()];if(e.devicePlatform===e.Platform.WebSupportsPush)return[2,P(t,r)];throw new w}))}))}var N=e.devicePlatform!==e.Platform.WebNoPushSupport&&e.devicePlatform!==e.Platform.Unknown,A=e.devicePlatform===e.Platform.WebSupportsPush,I=Promise.resolve().then((function(){return e.devicePlatform===e.Platform.iOSApp?function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return c.request=h,console.info("PUSH: Setting visibilitychange listener to pick up on new push tokens"),sessionStorage.getItem("pushkin-already-loaded")?f=!1:(f=!0,sessionStorage.setItem("pushkin-already-loaded","true")),window.addEventListener("visibilitychange",(function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return"hidden"===document.visibilityState?[2]:(console.info("PUSH: received visibilitychange event, checking for push token"),[4,l()]);case 1:return e.sent(),[2]}}))}))})),[4,l()];case 1:return e.sent(),[2]}}))}))}():e.devicePlatform===e.Platform.WebSupportsPush?function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return c.request=S,"permissions"in navigator?[4,navigator.permissions.query({name:"notifications"})]:[3,2];case 1:return e.sent().onchange=function(e){c.state=e.target.state},[3,3];case 2:"Notification"in window&&"permission"in Notification&&self.addEventListener("pagevisibility",(function(){"visible"===document.visibilityState&&(c.state=Notification.permission)})),e.label=3;case 3:return c.state=Notification.permission,[2]}}))}))}():void 0}));e.supportsNotifications=N,e.requiresServiceWorker=A,e.ready=I,e.setConfiguration=function(e){if(!e.key||!e.host||!e.ios)throw new Error("Must specify host, key and ios fields to configure Pushkin");t=e},e.clearCachedData=function(){return i(this,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return(t=O(navigator.userAgent,window))!==e.Platform.iOSApp?[3,2]:[4,function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){try{window.localStorage.removeItem(p())}catch(e){console.warn("Failed to clear cached data",e)}return[2]}))}))}()];case 1:return[2,n.sent()];case 2:return t!==e.Platform.AndroidApp?[3,3]:[3,5];case 3:return t!==e.Platform.WebSupportsPush?[3,5]:[4,function(){return i(this,void 0,void 0,(function(){var e,t,n,r=this;return s(this,(function(o){switch(o.label){case 0:return o.trys.push([0,6,,7]),[4,navigator.serviceWorker.ready];case 1:return[4,o.sent().pushManager.getSubscription()];case 2:return(e=o.sent())?[4,g()]:[3,5];case 3:return[4,k(t=o.sent(),["firebase-tokens"],"readwrite",(function(t){return i(r,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return[4,y((n=t.objectStore("firebase-tokens")).index("endpoint").getKey(e.endpoint))];case 1:return(r=o.sent())?[4,y(n.delete(r))]:[3,3];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}))];case 4:o.sent(),t.close(),o.label=5;case 5:return[3,7];case 6:return n=o.sent(),console.warn("Failed to clear cached data",n),[3,7];case 7:return[2]}}))}))}()];case 4:return[2,n.sent()];case 5:return[2]}}))}))},e.getFirebaseToken=j,e.areNotificationsEnabled=function(){return i(this,void 0,void 0,(function(){return s(this,(function(t){if(e.devicePlatform===e.Platform.iOSApp)return[2,function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return[4,d(!1)];case 1:return[2,!!e.sent()]}}))}))}()];if(e.devicePlatform===e.Platform.AndroidApp)return[2,function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Promise.resolve(!0)]}))}))}()];if(e.devicePlatform===e.Platform.WebSupportsPush)return[2,function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){return[2,Promise.resolve("granted"===Notification.permission)]}))}))}()];throw new w}))}))},e.subscribeToTopic=function(t,r){return i(this,void 0,void 0,(function(){var o,c;return s(this,(function(u){switch(u.label){case 0:return(o=O(navigator.userAgent,self))!==e.Platform.iOSApp&&o!==e.Platform.AndroidApp||!n.subscribeCloudFunctionURL?[4,j(!0,!0)]:[2,function(t,r){return i(this,void 0,void 0,(function(){var o,i,a;return s(this,(function(s){switch(s.label){case 0:if(!n.subscribeCloudFunctionURL)throw new Error("No cloud function");return[4,j(!0,!0)];case 1:if(!(o=s.sent()))throw new Error("Could not get Firebase token");return[4,fetch(n.subscribeCloudFunctionURL,{method:"POST",body:JSON.stringify({id:o,topics:[t],platform:r===e.Platform.iOSApp?"ios":"android"})})];case 2:return[4,(i=s.sent()).json()];case 3:if(a=s.sent(),!1===i.ok)throw new Error(a.error);return[2,a]}}))}))}(t,o)];case 1:if(!(c=u.sent()))throw new Error("Could not get Firebase token");return[4,a("/topics/"+t+"/subscribers/"+c,"POST",{confirmation:r})];case 2:return[2,u.sent()]}}))}))},e.unsubscribeFromTopic=function(e,t){return i(this,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return[4,j(!1,!0)];case 1:return(n=r.sent())?[4,a("/topics/"+e+"/subscribers/"+n,"DELETE",{confirmation:t})]:(console.log("no token"),[2,{success:!0}]);case 2:return[2,r.sent()]}}))}))},e.getSubscribedTopics=function(){return i(this,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,j(!1,!1)];case 1:return[4,a("/registrations/"+e.sent()+"/topics/")];case 2:return[2,e.sent()];case 3:return e.sent(),[2,[]];case 4:return[2]}}))}))},e.PermissionState=c,Object.defineProperty(e,"__esModule",{value:!0})}(t)}}]);
//# sourceMappingURL=NotificationToggle-139a64b65d9a6a6d764a.js.map